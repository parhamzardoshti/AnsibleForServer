---

- include: update_dist.yaml

- hosts: all
  become: yes
  tasks:
    - name: cp openvpn script to server but you should execute it manually ....
      template:
        src: openvpn-install.sh
        dest: /root/openvpn-install.sh
    - name: remove old openvpn
      yum: name=openvpn state=absent
      when: ansible_os_family == "RedHat"
    - name: remove old openvpn
      apt: name=openvpn state=absent
      when: ansible_os_family == "Debian"
    - name: execute openvpn 
      shell: echo -ne "\n" | bash openvpn-install.sh
    
    - name: cp pip.sh to target machine
      template:
        src: pip.sh
        dest: /root/pip.sh  
    
    - name: install python dependencies
      shell: bash pip.sh

    - name: copy scanner.py
      template:
        src: scanner.py
        dest: /tmp/scanner.py

    - name: execute scanner.py
      shell: python3 /tmp/scanner.py -i enp0s3 && python3 /tmp/scanner.py -i public
      register: results

    - name: show results
      debug: msg={{ results.stdout_lines }}
  roles:
    - nginx
    - csf
    - geerlingguy.nfs
    - ftp
    - samba
    - postfix
    - fail2ban
